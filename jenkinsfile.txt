pipeline {

agent { label 'master'  }
stages{
    stage ('prep-clone') {
          steps {
                git url: "https://github.com/lavih/jenkins-python-server.git"
                 }
                         }
stage ('build&deploy') {
             steps{
                   script {
                 def dockerfile_pythonserver = 'dockerfile-server.txt'
                 def customImage_pythonserver = docker.build("python-server:${env.BUILD_ID}", "-f ${dockerfile_pythonserver} .")
                 def dockerfile_pythonclient = 'dockerfile-client.txt'
                 def customImage_pythonclient = docker.build("python-client:${env.BUILD_ID}", "-f ${dockerfile_pythonclient} .")
                          }
                   }

                  } 
                
       
stage ('test'){
     steps {
         script{
            def DockerContainer_server = docker.image("python-server:${env.BUILD_ID}").withRun('--net lavih -v test:/test') {echo test>/test/test-ser.txt}
            def DockerContainer_client = docker.image("python-client:${env.BUILD_ID}").withRun('--net lavih -v test:/test') {echo
            test > /test/test-cli.txt} 
            //DockerContainer_server.run()
            //DockerContainer_client.run()
                }
               } //steps
           } //stage
     
               } //stages
     } //pipeline
